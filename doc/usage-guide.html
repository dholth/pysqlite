<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.3.8: http://docutils.sourceforge.net/" />
<title>pysqlite usage guide</title>
<link rel="stylesheet" href="default.css" type="text/css" />
</head>
<body>
<div class="document" id="pysqlite-usage-guide">
<h1 class="title">pysqlite usage guide</h1>
<div class="line-block">
<div class="line">(c) 2004-2005 David Rushby</div>
<div class="line">(c) 2005 Gerhard HÃ¤ring</div>
</div>
<p>Last updated for pysqlite 2.0beta1.</p>
<div class="section" id="table-of-contents">
<h1><a name="table-of-contents">Table Of Contents</a></h1>
<div class="line-block">
<div class="line"><a class="reference" href="#introduction">0. Introduction</a></div>
<div class="line"><a class="reference" href="#python-database-api-2-0-compliance">1. Python Database API 2.0 Compliance</a></div>
<div class="line-block">
<div class="line"><a class="reference" href="#incompatibilities">1.1 Incompatibilities</a></div>
<div class="line"><a class="reference" href="#unsupported-optional-features">1.2 Unsupported Optional Features</a></div>
<div class="line"><a class="reference" href="#nominally-supported-optional-features">1.3 Nominally Supported Optional Features</a></div>
<div class="line"><a class="reference" href="#extensions-and-caveats">1.4 Extensions and Caveats</a></div>
</div>
<div class="line"><a class="reference" href="#brief-tutorial">2. Brief Tutorial</a></div>
<div class="line-block">
<div class="line"><a class="reference" href="#connecting-to-a-database">2.1 Connecting to a Database</a></div>
<div class="line"><a class="reference" href="#executing-sql-statements">2.2 Executing SQL statements</a></div>
</div>
<div class="line"><a class="reference" href="#native-database-engine-features-and-extensions-beyond-the-python-db-api">3. Native Database Engine Features and Extensions Beyond the Python DB API</a></div>
<div class="line-block">
<div class="line"><a class="reference" href="#creating-user-defined-functions">3.1 Creating user-defined functions</a></div>
<div class="line"><a class="reference" href="#creating-user-defined-aggregates">3.2 Creating user-defined aggregates</a></div>
</div>
</div>
</div>
<div class="section" id="introduction">
<h1><a name="introduction">0. Introduction</a></h1>
<p>This Usage Guide is not a tutorial on Python, SQL, or SQLite; rather, it is a
topical presentation of pysqlite's feature set, with example code to
demonstrate basic usage patterns. This guide is meant to be consumed in
conjunction with the Python Database API Specification and the SQLite
documentation.</p>
<p>It was originally written by David Rushby for kinterbasdb. He kindly gave the
permission to adapt it for pysqlite.</p>
</div>
<div class="section" id="python-database-api-2-0-compliance">
<h1><a name="python-database-api-2-0-compliance">1. Python Database API 2.0 Compliance</a></h1>
<div class="section" id="incompatibilities">
<h2><a name="incompatibilities">1.1 Incompatibilities</a></h2>
<ul>
<li><p class="first">No type information in cursor.description</p>
<p><em>cursor.description</em> has a tuple with the fields (<em>name</em>, <em>type_code</em>,
<em>display_size</em>, <em>internal_size</em>, <em>precision</em>, <em>scale</em>, <em>null_ok</em>) for each
column that a query returns. The DB-API spec requires that at least <em>name</em>
and <em>type_code</em> are filled, but at the time cursor.description is built,
pysqlite cannot determine any types, yet. So, the only field of
<em>cursor.description</em> that pysqlite fills is <em>name</em>. All other fields are set to
None.</p>
</li>
</ul>
</div>
<div class="section" id="unsupported-optional-features">
<h2><a name="unsupported-optional-features">1.2 Unsupported Optional Features</a></h2>
<ul>
<li><p class="first"><strong>Cursor</strong> class</p>
<ul>
<li><p class="first"><strong>nextset</strong> method</p>
<p>This method is not implemented because the database engine does not
support opening multiple result sets simultaneously with a single
cursor.</p>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="nominally-supported-optional-features">
<h2><a name="nominally-supported-optional-features">1.3 Nominally Supported Optional Features</a></h2>
<ul>
<li><p class="first"><strong>Cursor</strong> class</p>
<ul>
<li><p class="first"><strong>arraysize</strong> attribute</p>
<p>As required by the spec, the value of this attribute is observed
with respect to the fetchmany method. However, changing the value
of this attribute does not make any difference in fetch efficiency
because the database engine only supports fetching a single row at
a time.</p>
</li>
<li><p class="first"><strong>setinputsizes</strong> method</p>
<p>Although this method is present, it does nothing, as allowed by the
spec.</p>
</li>
<li><p class="first"><strong>setoutputsize</strong> method</p>
<p>Although this method is present, it does nothing, as allowed by the
spec.</p>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="extensions-and-caveats">
<h2><a name="extensions-and-caveats">1.4 Extensions and Caveats</a></h2>
<p>pysqlite offers a large feature set beyond the minimal requirements of the
Python DB API. Most of these extensions are documented in the section of this
document entitled Native Database Engine Features and Extensions Beyond the
Python DB API.</p>
<ul>
<li><p class="first"><strong>connect</strong> function</p>
<p>The parameter <em>database</em> refers to the database file for the SQLite
database. It's a normal filesystem path and you can use absolute or
relative path names.</p>
<p>The connect function supports the following optional keyword arguments
in addition to those required by the spec:</p>
<ul>
<li><p class="first"><strong>timeout</strong> - When a database is accessed by multiple connections, and</p>
<p>one of the processes modifies the database, the SQLite database is
locked until that transaction is committed. The timeout parameter
specifies how long the connection should wait for the lock to go away
until raising an exception. The default for the timeout parameter is
5.0 (five seconds).</p>
<dl class="docutils">
<dt>Example:</dt>
<dd><div class="first last"><div class="code-block">
<span class="p_identifier">sqlite</span><span class="p_operator">.</span><span class="p_identifier">connect</span><span class="p_operator">(</span><span class="p_identifier">database</span><span class="p_operator">=</span><span class="p_string">"mydb"</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">timeout</span><span class="p_operator">=</span><span class="p_number">10.0</span><span class="p_operator">)</span>
</div>
</div></dd>
</dl>
</li>
<li><p class="first"><strong>autocommit</strong> - Some users don't want to work with transactions, or
want to write a layer on top of pysqlite that implementes transaction
management differently than pysqlite. With autocommit=True, pysqlite
does not issue BEGIN statements automatically any more. Note that you
can toggle the autocommit attribute of connections also.</p>
<p>Example:</p>
<div class="code-block">
<span class="p_identifier">sqlite</span><span class="p_operator">.</span><span class="p_identifier">connect</span><span class="p_operator">(</span><span class="p_string">"mydb"</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">autocommit</span><span class="p_operator">=</span><span class="p_identifier">True</span><span class="p_operator">)</span>
</div>
</li>
<li><p class="first"><strong>prepareProtocol</strong> - SQLite natively supports only the types TEXT (str
and unicode), INTEGER (int and long), FLOAT (float), BLOB (buffer)
and NULL (None). The names in brackets are the corresponding Python
types.</p>
<p>For using other Python types with SQLite, you need to add support to
them using pysqlite. You can do that by giving your custom Python
type a __conform__ method with this signature:</p>
<blockquote>
<div class="code-block">
<span class="p_word">def</span><span class="p_default">&nbsp;</span><span class="p_defname">__conform__</span><span class="p_operator">(</span><span class="p_identifier">self</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">protocol</span><span class="p_operator">):</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_operator">...</span>
</div>
</blockquote>
<p>The Python type then can check if protocol is an instance of
pysqlite.dbapi2.PrepareProtocol and adapt itself to one of SQLite's
supported Python types: str, unicode, int, long, float, buffer. Or
return None if it cannot adapt itself.</p>
<p>Normally, it's more practical to extend pysqlite's PrepareProtocol
instead so it supports your type.</p>
<p>For example if you wanted to add support for the standard Python
datetime.datetime type to pysqlite, you could do it like this:</p>
<blockquote>
<div class="code-block">
<span class="p_word">class</span><span class="p_default">&nbsp;</span><span class="p_classname">MyProtocol</span><span class="p_operator">:</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">def</span><span class="p_default">&nbsp;</span><span class="p_defname">__adapt__</span><span class="p_operator">(</span><span class="p_identifier">self</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">val</span><span class="p_operator">):</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">if</span><span class="p_default">&nbsp;</span><span class="p_identifier">type</span><span class="p_operator">(</span><span class="p_identifier">val</span><span class="p_operator">)</span><span class="p_default">&nbsp;</span><span class="p_word">is</span><span class="p_default">&nbsp;</span><span class="p_identifier">datetime</span><span class="p_operator">.</span><span class="p_identifier">datetime</span><span class="p_operator">:</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">return</span><span class="p_default">&nbsp;</span><span class="p_identifier">time</span><span class="p_operator">.</span><span class="p_identifier">mktime</span><span class="p_operator">(</span><span class="p_identifier">val</span><span class="p_operator">.</span><span class="p_identifier">timetuple</span><span class="p_operator">())</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">con</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_operator">.</span><span class="p_identifier">connect</span><span class="p_operator">(</span><span class="p_string">"mydb"</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">prepareProtocol</span><span class="p_operator">=</span><span class="p_identifier">MyProtocol</span><span class="p_operator">())</span><span class="p_default"><br/>
</span><span class="p_identifier">cur</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">con</span><span class="p_operator">.</span><span class="p_identifier">cursor</span><span class="p_operator">()</span><span class="p_default"><br/>
</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">execute</span><span class="p_operator">(</span><span class="p_string">"insert&nbsp;into&nbsp;mytable(ts)&nbsp;values&nbsp;(?)"</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_operator">(</span><span class="p_identifier">datetime</span><span class="p_operator">.</span><span class="p_identifier">datetime</span><span class="p_operator">.</span><span class="p_identifier">now</span><span class="p_operator">(),))</span>
</div>
</blockquote>
</li>
<li><p class="first"><strong>detect_types</strong> - SQLite natively supports only the types TEXT,
INTEGER, FLOAT, BLOB and NULL. If you want to use other types, like
date/time related ones, you have to add support for them yourself.
The <em>detect_types</em> parameter and the <em>converters</em> attribute of
connections allow you to easily do that.</p>
<p><em>detect_types</em> defaults to 0 (i. e. off, no type detection), you can
set it to any combination of <em>PARSE_DECLTYPES</em> and <em>PARSE_COLNAMES</em> to turn
type detection on.</p>
<ul>
<li><p class="first"><strong>sqlite.PARSE_DECLTYPES</strong> - This makes pysqlite parse the declared
type for each column it returns. It will parse out the first word
of the declared type, i. e. for &quot;integer primary key&quot;, it will
parse out &quot;integer&quot;. Then for that column, it will look into the
converters property of the connection (a dictionary that you can
modify at will) and use the converter function registered for
that type there.</p>
<p>Example:</p>
<div class="code-block">
<span class="p_word">class</span><span class="p_default">&nbsp;</span><span class="p_classname">MyProtocol</span><span class="p_operator">:</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">def</span><span class="p_default">&nbsp;</span><span class="p_defname">__adapt__</span><span class="p_operator">(</span><span class="p_identifier">self</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">val</span><span class="p_operator">):</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">if</span><span class="p_default">&nbsp;</span><span class="p_identifier">type</span><span class="p_operator">(</span><span class="p_identifier">val</span><span class="p_operator">)</span><span class="p_default">&nbsp;</span><span class="p_word">is</span><span class="p_default">&nbsp;</span><span class="p_identifier">datetime</span><span class="p_operator">.</span><span class="p_identifier">datetime</span><span class="p_operator">:</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">return</span><span class="p_default">&nbsp;</span><span class="p_identifier">time</span><span class="p_operator">.</span><span class="p_identifier">mktime</span><span class="p_operator">(</span><span class="p_identifier">val</span><span class="p_operator">.</span><span class="p_identifier">timetuple</span><span class="p_operator">())</span><span class="p_default"><br/>
<br/>
</span><span class="p_word">def</span><span class="p_default">&nbsp;</span><span class="p_defname">dt_from_float</span><span class="p_operator">(</span><span class="p_identifier">val</span><span class="p_operator">):</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">return</span><span class="p_default">&nbsp;</span><span class="p_identifier">datetime</span><span class="p_operator">.</span><span class="p_identifier">datetime</span><span class="p_operator">.</span><span class="p_identifier">fromtimestamp</span><span class="p_operator">(</span><span class="p_identifier">float</span><span class="p_operator">(</span><span class="p_identifier">val</span><span class="p_operator">))</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">con</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_operator">.</span><span class="p_identifier">connect</span><span class="p_operator">(</span><span class="p_string">":memory:"</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">prepareProtocol</span><span class="p_operator">=</span><span class="p_identifier">MyProtocol</span><span class="p_operator">(),</span><span class="p_default">&nbsp;</span><span class="p_identifier">detect_types</span><span class="p_operator">=</span><span class="p_identifier">sqlite</span><span class="p_operator">.</span><span class="p_identifier">PARSE_DECLTYPES</span><span class="p_operator">)</span><span class="p_default"><br/>
</span><span class="p_identifier">con</span><span class="p_operator">.</span><span class="p_identifier">converters</span><span class="p_operator">[</span><span class="p_string">"datetime"</span><span class="p_operator">]</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">dt_from_float</span><span class="p_default"><br/>
</span><span class="p_identifier">cur</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">con</span><span class="p_operator">.</span><span class="p_identifier">cursor</span><span class="p_operator">()</span><span class="p_default"><br/>
</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">execute</span><span class="p_operator">(</span><span class="p_string">"create&nbsp;table&nbsp;test(ts&nbsp;datetime)"</span><span class="p_operator">)</span><span class="p_default"><br/>
</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">execute</span><span class="p_operator">(</span><span class="p_string">"insert&nbsp;into&nbsp;test(ts)&nbsp;values&nbsp;(?)"</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_operator">(</span><span class="p_identifier">datetime</span><span class="p_operator">.</span><span class="p_identifier">datetime</span><span class="p_operator">.</span><span class="p_identifier">now</span><span class="p_operator">(),))</span><span class="p_default"><br/>
</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">execute</span><span class="p_operator">(</span><span class="p_string">"select&nbsp;ts&nbsp;from&nbsp;test"</span><span class="p_operator">)</span><span class="p_default"><br/>
</span><span class="p_identifier">dt</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">fetchone</span><span class="p_operator">()[</span><span class="p_number">0</span><span class="p_operator">]</span><span class="p_default"><br/>
</span><span class="p_word">print</span><span class="p_default">&nbsp;</span><span class="p_identifier">dt</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">type</span><span class="p_operator">(</span><span class="p_identifier">dt</span><span class="p_operator">)</span><span class="p_default"><br/>
</span><span class="p_identifier">dt</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">fetchone</span><span class="p_operator">()[</span><span class="p_number">0</span><span class="p_operator">]</span><span class="p_default"><br/>
</span><span class="p_word">print</span><span class="p_default">&nbsp;</span><span class="p_identifier">dt</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">type</span><span class="p_operator">(</span><span class="p_identifier">dt</span><span class="p_operator">)</span>
</div>
</li>
<li><p class="first"><strong>sqlite.PARSE_COLNAMES</strong> - This makes pysqlite parse the column name
for each column it returns. It will look for a string formed
[mytype] in there, and then decide that 'mytype' is the type of
the column. It will try to find an entry of 'mytype' in the
converters dictionary and then use the converter function found
there to return the value. The column name found in
cursor.description is only the first word of the column name, i.
e. if you use something like 'as &quot;x [datetime]&quot;' in your SQL,
then pysqlite will parse out everything until the first blank for
the column name: the column name would simply be &quot;x&quot;.</p>
<p>Example:</p>
<div class="code-block">
<span class="p_identifier">cur</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">con</span><span class="p_operator">.</span><span class="p_identifier">cursor</span><span class="p_operator">()</span><span class="p_default"><br/>
</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">execute</span><span class="p_operator">(</span><span class="p_character">'select&nbsp;?&nbsp;as&nbsp;"x&nbsp;[datetime]"'</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_operator">(</span><span class="p_identifier">datetime</span><span class="p_operator">.</span><span class="p_identifier">datetime</span><span class="p_operator">.</span><span class="p_identifier">now</span><span class="p_operator">(),))</span><span class="p_default"><br/>
</span><span class="p_identifier">dt</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">fetchone</span><span class="p_operator">()[</span><span class="p_number">0</span><span class="p_operator">]</span><span class="p_default"><br/>
</span><span class="p_word">print</span><span class="p_default">&nbsp;</span><span class="p_identifier">dt</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">type</span><span class="p_operator">(</span><span class="p_identifier">dt</span><span class="p_operator">)</span>
</div>
</li>
</ul>
</li>
<li><p class="first"><strong>check_same_thread</strong> - SQLite connections/cursors can only safely be
used in the same thread they were created in. pysqlite checks for
this each time it would do a call to the SQLite engine. If you are
confident that you are ensuring safety otherwise, you can disable
that checks by setting check_same_thread to False.</p>
</li>
<li><p class="first"><strong>factory</strong> - By default, pysqlite uses the Connection class for the
connect call. You can, however, subclass the Connection class and
make .connect() use your class instead by providing your class for
the factory parameter.</p>
<p>Example:</p>
<div class="code-block">
<span class="p_word">from</span><span class="p_default">&nbsp;</span><span class="p_identifier">pysqlite2</span><span class="p_default">&nbsp;</span><span class="p_word">import</span><span class="p_default">&nbsp;</span><span class="p_identifier">dbapi2</span><span class="p_default">&nbsp;</span><span class="p_word">as</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_default"><br/>
<br/>
</span><span class="p_word">class</span><span class="p_default">&nbsp;</span><span class="p_classname">CountCursorsConnection</span><span class="p_operator">(</span><span class="p_identifier">sqlite</span><span class="p_operator">.</span><span class="p_identifier">Connection</span><span class="p_operator">):</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">def</span><span class="p_default">&nbsp;</span><span class="p_defname">__init__</span><span class="p_operator">(</span><span class="p_identifier">self</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_operator">*</span><span class="p_identifier">args</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_operator">**</span><span class="p_identifier">kwargs</span><span class="p_operator">):</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_operator">.</span><span class="p_identifier">Connection</span><span class="p_operator">.</span><span class="p_identifier">__init__</span><span class="p_operator">(</span><span class="p_identifier">self</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_operator">*</span><span class="p_identifier">args</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_operator">**</span><span class="p_identifier">kwargs</span><span class="p_operator">)</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">self</span><span class="p_operator">.</span><span class="p_identifier">numcursors</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_number">0</span><span class="p_default"><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">def</span><span class="p_default">&nbsp;</span><span class="p_defname">cursor</span><span class="p_operator">(</span><span class="p_identifier">self</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_operator">*</span><span class="p_identifier">args</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_operator">**</span><span class="p_identifier">kwargs</span><span class="p_operator">):</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">self</span><span class="p_operator">.</span><span class="p_identifier">numcursors</span><span class="p_default">&nbsp;</span><span class="p_operator">+=</span><span class="p_default">&nbsp;</span><span class="p_number">1</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">return</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_operator">.</span><span class="p_identifier">Connection</span><span class="p_operator">.</span><span class="p_identifier">cursor</span><span class="p_operator">(</span><span class="p_identifier">self</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_operator">*</span><span class="p_identifier">args</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_operator">**</span><span class="p_identifier">kwargs</span><span class="p_operator">)</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">con</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_operator">.</span><span class="p_identifier">connect</span><span class="p_operator">(</span><span class="p_string">":memory:"</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">factory</span><span class="p_operator">=</span><span class="p_identifier">CountCursorsConnection</span><span class="p_operator">)</span><span class="p_default"><br/>
</span><span class="p_identifier">cur1</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">con</span><span class="p_operator">.</span><span class="p_identifier">cursor</span><span class="p_operator">()</span><span class="p_default"><br/>
</span><span class="p_identifier">cur2</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">con</span><span class="p_operator">.</span><span class="p_identifier">cursor</span><span class="p_operator">()</span><span class="p_default"><br/>
</span><span class="p_word">print</span><span class="p_default">&nbsp;</span><span class="p_identifier">con</span><span class="p_operator">.</span><span class="p_identifier">numcursors</span>
</div>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</li>
<li><p class="first"><strong>Connection</strong> class</p>
<ul>
<li><p class="first"><strong>autocommit</strong> attribute (read-write)
Some users don't want to work with transactions, or want to write a
layer on top of pysqlite that implementes transaction management
differently than pysqlite. With autocommit=True, pysqlite does not
issue BEGIN statements automatically any more. Note that you set the
autocommit value at connection creation time using the autocommit
parameter to connect also.</p>
</li>
<li><p class="first"><strong>converters</strong> attribute (read-write)
This dictionary maps type names to converter functions, it's empty by
default, and you can replace it with your own dictionary or modify
it.</p>
</li>
<li><p class="first"><strong>cursor method</strong> - The cursor method accepts a single optional parameter:
a custom cursor class extending pysqlite's <em>Cursor</em> class that you can
adapt to your needs. Note that it is required that your custom cursor class
extends pysqlite's <em>Cursor</em> class.</p>
<p>For a useful example, look at the example for the <em>row_factory</em> attribute
of cursors.</p>
</li>
</ul>
</li>
<li><p class="first"><strong>Cursor</strong> class</p>
<ul>
<li><p class="first"><strong>execute</strong> method</p>
<p>pysqlite uses <em>paramstyle = &quot;qmark&quot;</em>. That means if you use parametrized
statements, you use the question mark as placeholder.</p>
<p>This is a basic example showing the use of question marks as placeholders
and a parameter tuple:</p>
<div class="code-block">
<span class="p_word">from</span><span class="p_default">&nbsp;</span><span class="p_identifier">pysqlite2</span><span class="p_default">&nbsp;</span><span class="p_word">import</span><span class="p_default">&nbsp;</span><span class="p_identifier">dbapi2</span><span class="p_default">&nbsp;</span><span class="p_word">as</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">con</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_operator">.</span><span class="p_identifier">connect</span><span class="p_operator">(</span><span class="p_string">"mydb"</span><span class="p_operator">)</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">cur</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">con</span><span class="p_operator">.</span><span class="p_identifier">cursor</span><span class="p_operator">()</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">who</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_string">"Yeltsin"</span><span class="p_default"><br/>
</span><span class="p_identifier">age</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_number">72</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">execute</span><span class="p_operator">(</span><span class="p_string">"select&nbsp;name_last,&nbsp;age&nbsp;from&nbsp;people&nbsp;where&nbsp;name_last=?&nbsp;and&nbsp;age=?"</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_operator">(</span><span class="p_identifier">who</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">age</span><span class="p_operator">))</span><span class="p_default"><br/>
</span><span class="p_word">print</span><span class="p_default">&nbsp;</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">fetchone</span><span class="p_operator">()</span>
</div>
<p>pysqlite also supports <em>paramstyle = &quot;named&quot;</em>. That means you can use named
placeholders in the format &quot;:name&quot;, i. e. a colon followed by the parameter
name. As parameters, you then supply a mapping instead of a sequence. In
the simplest case, a dictionary instead of a tuple.</p>
<div class="code-block">
<span class="p_word">from</span><span class="p_default">&nbsp;</span><span class="p_identifier">pysqlite2</span><span class="p_default">&nbsp;</span><span class="p_word">import</span><span class="p_default">&nbsp;</span><span class="p_identifier">dbapi2</span><span class="p_default">&nbsp;</span><span class="p_word">as</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">con</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_operator">.</span><span class="p_identifier">connect</span><span class="p_operator">(</span><span class="p_string">"mydb"</span><span class="p_operator">)</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">cur</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">con</span><span class="p_operator">.</span><span class="p_identifier">cursor</span><span class="p_operator">()</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">who</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_string">"Yeltsin"</span><span class="p_default"><br/>
</span><span class="p_identifier">age</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_number">72</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">execute</span><span class="p_operator">(</span><span class="p_string">"select&nbsp;name_last,&nbsp;age&nbsp;from&nbsp;people&nbsp;where&nbsp;name_last=:who&nbsp;and&nbsp;age=:age"</span><span class="p_operator">,</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_operator">{</span><span class="p_string">"who"</span><span class="p_operator">:</span><span class="p_default">&nbsp;</span><span class="p_identifier">who</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_string">"age"</span><span class="p_operator">:</span><span class="p_default">&nbsp;</span><span class="p_identifier">age</span><span class="p_operator">})</span><span class="p_default"><br/>
</span><span class="p_word">print</span><span class="p_default">&nbsp;</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">fetchone</span><span class="p_operator">()</span><span class="p_default"><br/>
</span>
</div>
<p>The following example shows a shortcut that you can often use when using
named parameters. It exploits the fact that locals() is a dictionary, too.
So you can also use it as parameter for <em>execute</em>:</p>
<div class="code-block">
<span class="p_word">from</span><span class="p_default">&nbsp;</span><span class="p_identifier">pysqlite2</span><span class="p_default">&nbsp;</span><span class="p_word">import</span><span class="p_default">&nbsp;</span><span class="p_identifier">dbapi2</span><span class="p_default">&nbsp;</span><span class="p_word">as</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">con</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_operator">.</span><span class="p_identifier">connect</span><span class="p_operator">(</span><span class="p_string">"mydb"</span><span class="p_operator">)</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">cur</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">con</span><span class="p_operator">.</span><span class="p_identifier">cursor</span><span class="p_operator">()</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">who</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_string">"Yeltsin"</span><span class="p_default"><br/>
</span><span class="p_identifier">age</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_number">72</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">execute</span><span class="p_operator">(</span><span class="p_string">"select&nbsp;name_last,&nbsp;age&nbsp;from&nbsp;people&nbsp;where&nbsp;name_last=:who&nbsp;and&nbsp;age=:age"</span><span class="p_operator">,</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">locals</span><span class="p_operator">())</span><span class="p_default"><br/>
</span><span class="p_word">print</span><span class="p_default">&nbsp;</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">fetchone</span><span class="p_operator">()</span><span class="p_default"><br/>
<br/>
</span>
</div>
</li>
<li><p class="first"><strong>executemany</strong> method</p>
<p>The DB-API specifies the executemany method like this:</p>
<div class="code-block">
<span class="p_operator">.</span><span class="p_identifier">executemany</span><span class="p_operator">(</span><span class="p_identifier">operation</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">seq_of_parameters</span><span class="p_operator">)</span>
</div>
<p>pysqlite, however, extends <em>executemany</em> so it can be used more efficiently
for inserting bulk data. The second parameter to <em>executemany</em> can be a
<em>sequence of parameters</em>, but it can also be an <em>iterator</em> returning
parameters.</p>
<p>Example:</p>
<div class="code-block">
<span class="p_word">from</span><span class="p_default">&nbsp;</span><span class="p_identifier">pysqlite2</span><span class="p_default">&nbsp;</span><span class="p_word">import</span><span class="p_default">&nbsp;</span><span class="p_identifier">dbapi2</span><span class="p_default">&nbsp;</span><span class="p_word">as</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_default"><br/>
<br/>
</span><span class="p_word">class</span><span class="p_default">&nbsp;</span><span class="p_classname">IterChars</span><span class="p_operator">:</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">def</span><span class="p_default">&nbsp;</span><span class="p_defname">__init__</span><span class="p_operator">(</span><span class="p_identifier">self</span><span class="p_operator">):</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">self</span><span class="p_operator">.</span><span class="p_identifier">count</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">ord</span><span class="p_operator">(</span><span class="p_character">'a'</span><span class="p_operator">)</span><span class="p_default"><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">def</span><span class="p_default">&nbsp;</span><span class="p_defname">__iter__</span><span class="p_operator">(</span><span class="p_identifier">self</span><span class="p_operator">):</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">return</span><span class="p_default">&nbsp;</span><span class="p_identifier">self</span><span class="p_default"><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">def</span><span class="p_default">&nbsp;</span><span class="p_defname">next</span><span class="p_operator">(</span><span class="p_identifier">self</span><span class="p_operator">):</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">if</span><span class="p_default">&nbsp;</span><span class="p_identifier">self</span><span class="p_operator">.</span><span class="p_identifier">count</span><span class="p_default">&nbsp;</span><span class="p_operator">&gt;</span><span class="p_default">&nbsp;</span><span class="p_identifier">ord</span><span class="p_operator">(</span><span class="p_character">'z'</span><span class="p_operator">):</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">raise</span><span class="p_default">&nbsp;</span><span class="p_identifier">StopIteration</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">self</span><span class="p_operator">.</span><span class="p_identifier">count</span><span class="p_default">&nbsp;</span><span class="p_operator">+=</span><span class="p_default">&nbsp;</span><span class="p_number">1</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">return</span><span class="p_default">&nbsp;</span><span class="p_operator">(</span><span class="p_identifier">chr</span><span class="p_operator">(</span><span class="p_identifier">self</span><span class="p_operator">.</span><span class="p_identifier">count</span><span class="p_default">&nbsp;</span><span class="p_operator">-</span><span class="p_default">&nbsp;</span><span class="p_number">1</span><span class="p_operator">),)</span><span class="p_default">&nbsp;</span><span class="p_commentline">#&nbsp;this&nbsp;is&nbsp;a&nbsp;1-tuple</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">con</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_operator">.</span><span class="p_identifier">connect</span><span class="p_operator">(</span><span class="p_string">":memory:"</span><span class="p_operator">)</span><span class="p_default"><br/>
</span><span class="p_identifier">cur</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">con</span><span class="p_operator">.</span><span class="p_identifier">cursor</span><span class="p_operator">()</span><span class="p_default"><br/>
</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">execute</span><span class="p_operator">(</span><span class="p_string">"create&nbsp;table&nbsp;characters(c)"</span><span class="p_operator">)</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">theIter</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">IterChars</span><span class="p_operator">()</span><span class="p_default"><br/>
</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">executemany</span><span class="p_operator">(</span><span class="p_string">"insert&nbsp;into&nbsp;characters(c)&nbsp;values&nbsp;(?)"</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">theIter</span><span class="p_operator">)</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">execute</span><span class="p_operator">(</span><span class="p_string">"select&nbsp;c&nbsp;from&nbsp;characters"</span><span class="p_operator">)</span><span class="p_default"><br/>
</span><span class="p_word">print</span><span class="p_default">&nbsp;</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">fetchall</span><span class="p_operator">()</span>
</div>
<p>As generators are iterators, too, here's a much simpler, equivalent example
using a generator:</p>
<div class="code-block">
<span class="p_word">from</span><span class="p_default">&nbsp;</span><span class="p_identifier">pysqlite2</span><span class="p_default">&nbsp;</span><span class="p_word">import</span><span class="p_default">&nbsp;</span><span class="p_identifier">dbapi2</span><span class="p_default">&nbsp;</span><span class="p_word">as</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_default"><br/>
<br/>
</span><span class="p_word">def</span><span class="p_default">&nbsp;</span><span class="p_defname">char_generator</span><span class="p_operator">():</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">import</span><span class="p_default">&nbsp;</span><span class="p_identifier">string</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">for</span><span class="p_default">&nbsp;</span><span class="p_identifier">c</span><span class="p_default">&nbsp;</span><span class="p_word">in</span><span class="p_default">&nbsp;</span><span class="p_identifier">string</span><span class="p_operator">.</span><span class="p_identifier">letters</span><span class="p_operator">[:</span><span class="p_number">26</span><span class="p_operator">]:</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">yield</span><span class="p_default">&nbsp;</span><span class="p_operator">(</span><span class="p_identifier">c</span><span class="p_operator">,)</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">con</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_operator">.</span><span class="p_identifier">connect</span><span class="p_operator">(</span><span class="p_string">":memory:"</span><span class="p_operator">)</span><span class="p_default"><br/>
</span><span class="p_identifier">cur</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">con</span><span class="p_operator">.</span><span class="p_identifier">cursor</span><span class="p_operator">()</span><span class="p_default"><br/>
</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">execute</span><span class="p_operator">(</span><span class="p_string">"create&nbsp;table&nbsp;characters(c)"</span><span class="p_operator">)</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">executemany</span><span class="p_operator">(</span><span class="p_string">"insert&nbsp;into&nbsp;characters(c)&nbsp;values&nbsp;(?)"</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">char_generator</span><span class="p_operator">())</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">execute</span><span class="p_operator">(</span><span class="p_string">"select&nbsp;c&nbsp;from&nbsp;characters"</span><span class="p_operator">)</span><span class="p_default"><br/>
</span><span class="p_word">print</span><span class="p_default">&nbsp;</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">fetchall</span><span class="p_operator">()</span>
</div>
</li>
<li><p class="first"><strong>rowcount</strong> attribute</p>
<p>Although pysqlite's Cursors implement this attribute, the database
engine's own support for the determination of &quot;rows affected&quot;/&quot;rows
selected&quot; is quirky.</p>
<p>For <tt class="docutils literal"><span class="pre">SELECT</span></tt> statements, <em>rowcount</em> is always None because pysqlite
cannot determine the number of rows a query produced until all rows
were fetched.</p>
<p>For <tt class="docutils literal"><span class="pre">DELETE</span></tt> statements, SQLite reports <em>rowcount</em> as 0 if you make a
<tt class="docutils literal"><span class="pre">DELETE</span> <span class="pre">FROM</span> <span class="pre">table</span></tt> without any condition.</p>
<p>For <em>executemany</em> statements, pysqlite sums up the number of
modifications into <em>rowcount</em>.</p>
<p>As required by the Python DB API Spec, the <em>rowcount</em> attribute &quot;is -1
in case no executeXX() has been performed on the cursor or the rowcount
of the last operation is not determinable by the interface&quot;.</p>
</li>
<li><p class="first"><strong>row_factory</strong> attribute (read-write)</p>
<p>You can change this attribute to a callable that accepts the cursor and
the original row as tuple and will return the real result row.  This
way, you can implement more advanced ways of returning results, like
ones that can also access columns by name.</p>
<p>Example:</p>
<div class="code-block">
<span class="p_word">from</span><span class="p_default">&nbsp;</span><span class="p_identifier">pysqlite2</span><span class="p_default">&nbsp;</span><span class="p_word">import</span><span class="p_default">&nbsp;</span><span class="p_identifier">dbapi2</span><span class="p_default">&nbsp;</span><span class="p_word">as</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_default"><br/>
<br/>
</span><span class="p_word">def</span><span class="p_default">&nbsp;</span><span class="p_defname">dict_factory</span><span class="p_operator">(</span><span class="p_identifier">cursor</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">row</span><span class="p_operator">):</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">d</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_operator">{}</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">for</span><span class="p_default">&nbsp;</span><span class="p_identifier">idx</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">col</span><span class="p_default">&nbsp;</span><span class="p_word">in</span><span class="p_default">&nbsp;</span><span class="p_identifier">enumerate</span><span class="p_operator">(</span><span class="p_identifier">cursor</span><span class="p_operator">.</span><span class="p_identifier">description</span><span class="p_operator">):</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">d</span><span class="p_operator">[</span><span class="p_identifier">col</span><span class="p_operator">[</span><span class="p_number">0</span><span class="p_operator">]]</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">row</span><span class="p_operator">[</span><span class="p_identifier">idx</span><span class="p_operator">]</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">return</span><span class="p_default">&nbsp;</span><span class="p_identifier">d</span><span class="p_default"><br/>
<br/>
</span><span class="p_word">class</span><span class="p_default">&nbsp;</span><span class="p_classname">DictCursor</span><span class="p_operator">(</span><span class="p_identifier">sqlite</span><span class="p_operator">.</span><span class="p_identifier">Cursor</span><span class="p_operator">):</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">def</span><span class="p_default">&nbsp;</span><span class="p_defname">__init__</span><span class="p_operator">(</span><span class="p_identifier">self</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_operator">*</span><span class="p_identifier">args</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_operator">**</span><span class="p_identifier">kwargs</span><span class="p_operator">):</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_operator">.</span><span class="p_identifier">Cursor</span><span class="p_operator">.</span><span class="p_identifier">__init__</span><span class="p_operator">(</span><span class="p_identifier">self</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_operator">*</span><span class="p_identifier">args</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_operator">**</span><span class="p_identifier">kwargs</span><span class="p_operator">)</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">self</span><span class="p_operator">.</span><span class="p_identifier">row_factory</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_word">lambda</span><span class="p_default">&nbsp;</span><span class="p_identifier">row</span><span class="p_operator">:</span><span class="p_default">&nbsp;</span><span class="p_identifier">dict_factory</span><span class="p_operator">(</span><span class="p_identifier">self</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">row</span><span class="p_operator">)</span><span class="p_default"><br/>
<br/>
<br/>
</span><span class="p_identifier">con</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_operator">.</span><span class="p_identifier">connect</span><span class="p_operator">(</span><span class="p_string">":memory:"</span><span class="p_operator">)</span><span class="p_default"><br/>
</span><span class="p_identifier">cur</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">con</span><span class="p_operator">.</span><span class="p_identifier">cursor</span><span class="p_operator">(</span><span class="p_identifier">factory</span><span class="p_operator">=</span><span class="p_identifier">DictCursor</span><span class="p_operator">)</span><span class="p_default"><br/>
</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">execute</span><span class="p_operator">(</span><span class="p_string">"select&nbsp;1&nbsp;as&nbsp;a"</span><span class="p_operator">)</span><span class="p_default"><br/>
</span><span class="p_word">print</span><span class="p_default">&nbsp;</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">fetchone</span><span class="p_operator">()[</span><span class="p_string">"a"</span><span class="p_operator">]</span>
</div>
</li>
</ul>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<hr class="docutils" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="brief-tutorial">
<h1><a name="brief-tutorial">2. Brief Tutorial</a></h1>
<p>This brief tutorial aims to get the reader started by demonstrating elementary
usage of pysqlite. It is not a comprehensive Python Database API tutorial, nor
is it comprehensive in its coverage of anything else.</p>
<div class="section" id="connecting-to-a-database">
<h2><a name="connecting-to-a-database">2.1 Connecting to a Database</a></h2>
<blockquote>
<p><strong>Example 1</strong></p>
<p>Connecting to a database file <em>mydb</em>:</p>
<div class="code-block">
<span class="p_word">from</span><span class="p_default">&nbsp;</span><span class="p_identifier">pysqlite2</span><span class="p_default">&nbsp;</span><span class="p_word">import</span><span class="p_default">&nbsp;</span><span class="p_identifier">dbapi2</span><span class="p_default">&nbsp;</span><span class="p_word">as</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">con</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_operator">.</span><span class="p_identifier">connect</span><span class="p_operator">(</span><span class="p_string">"mydb"</span><span class="p_operator">)</span>
</div>
<p><strong>Example 2</strong></p>
<p>Creating an in-memory database:</p>
<div class="code-block">
<span class="p_word">from</span><span class="p_default">&nbsp;</span><span class="p_identifier">pysqlite2</span><span class="p_default">&nbsp;</span><span class="p_word">import</span><span class="p_default">&nbsp;</span><span class="p_identifier">dbapi2</span><span class="p_default">&nbsp;</span><span class="p_word">as</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">con</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_operator">.</span><span class="p_identifier">connect</span><span class="p_operator">(</span><span class="p_string">":memory:"</span><span class="p_operator">)</span>
</div>
</blockquote>
</div>
<div class="section" id="executing-sql-statements">
<h2><a name="executing-sql-statements">2.2 Executing SQL statements</a></h2>
<p>For this section, we have a database <em>mydb</em> defined and populated by the
following SQL code:</p>
<blockquote>
<div class="code-block">
<span class="c_identifier">create</span><span class="c_default">&nbsp;</span><span class="c_identifier">table</span><span class="c_default">&nbsp;</span><span class="c_identifier">people</span><span class="c_default"><br/>
</span><span class="c_operator">(</span><span class="c_default"><br/>
&nbsp;&nbsp;</span><span class="c_identifier">name_last</span><span class="c_default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c_identifier">varchar</span><span class="c_operator">(</span><span class="c_number">20</span><span class="c_operator">),</span><span class="c_default"><br/>
&nbsp;&nbsp;</span><span class="c_identifier">age</span><span class="c_default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c_identifier">integer</span><span class="c_default"><br/>
</span><span class="c_operator">);</span><span class="c_default"><br/>
<br/>
</span><span class="c_identifier">insert</span><span class="c_default">&nbsp;</span><span class="c_identifier">into</span><span class="c_default">&nbsp;</span><span class="c_identifier">people</span><span class="c_default">&nbsp;</span><span class="c_operator">(</span><span class="c_identifier">name_last</span><span class="c_operator">,</span><span class="c_default">&nbsp;</span><span class="c_identifier">age</span><span class="c_operator">)</span><span class="c_default">&nbsp;</span><span class="c_identifier">values</span><span class="c_default">&nbsp;</span><span class="c_operator">(</span><span class="c_character">'Yeltsin'</span><span class="c_operator">,</span><span class="c_default">&nbsp;&nbsp;&nbsp;</span><span class="c_number">72</span><span class="c_operator">);</span><span class="c_default"><br/>
</span><span class="c_identifier">insert</span><span class="c_default">&nbsp;</span><span class="c_identifier">into</span><span class="c_default">&nbsp;</span><span class="c_identifier">people</span><span class="c_default">&nbsp;</span><span class="c_operator">(</span><span class="c_identifier">name_last</span><span class="c_operator">,</span><span class="c_default">&nbsp;</span><span class="c_identifier">age</span><span class="c_operator">)</span><span class="c_default">&nbsp;</span><span class="c_identifier">values</span><span class="c_default">&nbsp;</span><span class="c_operator">(</span><span class="c_character">'Putin'</span><span class="c_operator">,</span><span class="c_default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c_number">51</span><span class="c_operator">);</span>
</div>
</blockquote>
<p><em>Example 1</em></p>
<p>This example shows the simplest way to print the entire contents of the <tt class="docutils literal"><span class="pre">people</span></tt> table:</p>
<div class="code-block">
<span class="p_word">from</span><span class="p_default">&nbsp;</span><span class="p_identifier">pysqlite2</span><span class="p_default">&nbsp;</span><span class="p_word">import</span><span class="p_default">&nbsp;</span><span class="p_identifier">dbapi2</span><span class="p_default">&nbsp;</span><span class="p_word">as</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_default"><br/>
<br/>
</span><span class="p_commentline">#&nbsp;Create&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;database&nbsp;file&nbsp;"mydb":</span><span class="p_default"><br/>
</span><span class="p_identifier">con</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_operator">.</span><span class="p_identifier">connect</span><span class="p_operator">(</span><span class="p_string">"mydb"</span><span class="p_operator">)</span><span class="p_default"><br/>
<br/>
</span><span class="p_commentline">#&nbsp;Get&nbsp;a&nbsp;Cursor&nbsp;object&nbsp;that&nbsp;operates&nbsp;in&nbsp;the&nbsp;context&nbsp;of&nbsp;Connection&nbsp;con:</span><span class="p_default"><br/>
</span><span class="p_identifier">cur</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">con</span><span class="p_operator">.</span><span class="p_identifier">cursor</span><span class="p_operator">()</span><span class="p_default"><br/>
<br/>
</span><span class="p_commentline">#&nbsp;Execute&nbsp;the&nbsp;SELECT&nbsp;statement:</span><span class="p_default"><br/>
</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">execute</span><span class="p_operator">(</span><span class="p_string">"select&nbsp;*&nbsp;from&nbsp;people&nbsp;order&nbsp;by&nbsp;age"</span><span class="p_operator">)</span><span class="p_default"><br/>
<br/>
</span><span class="p_commentline">#&nbsp;Retrieve&nbsp;all&nbsp;rows&nbsp;as&nbsp;a&nbsp;sequence&nbsp;and&nbsp;print&nbsp;that&nbsp;sequence:</span><span class="p_default"><br/>
</span><span class="p_word">print</span><span class="p_default">&nbsp;</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">fetchall</span><span class="p_operator">()</span>
</div>
<p>Sample output:</p>
<pre class="literal-block">
[(u'Putin', 51), (u'Yeltsin', 72)]
</pre>
<p><em>Example 2</em></p>
<p>Here's another trivial example that demonstrates various ways of fetching a
single row at a time from a SELECT-cursor:</p>
<div class="code-block">
<span class="p_word">from</span><span class="p_default">&nbsp;</span><span class="p_identifier">pysqlite2</span><span class="p_default">&nbsp;</span><span class="p_word">import</span><span class="p_default">&nbsp;</span><span class="p_identifier">dbapi2</span><span class="p_default">&nbsp;</span><span class="p_word">as</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">con</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_operator">.</span><span class="p_identifier">connect</span><span class="p_operator">(</span><span class="p_string">"mydb"</span><span class="p_operator">)</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">cur</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">con</span><span class="p_operator">.</span><span class="p_identifier">cursor</span><span class="p_operator">()</span><span class="p_default"><br/>
</span><span class="p_identifier">SELECT</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_string">"select&nbsp;name_last,&nbsp;age&nbsp;from&nbsp;people&nbsp;order&nbsp;by&nbsp;age,&nbsp;name_last"</span><span class="p_default"><br/>
<br/>
</span><span class="p_commentline">#&nbsp;1.&nbsp;Iterate&nbsp;over&nbsp;the&nbsp;rows&nbsp;available&nbsp;from&nbsp;the&nbsp;cursor,&nbsp;unpacking&nbsp;the</span><span class="p_default"><br/>
</span><span class="p_commentline">#&nbsp;resulting&nbsp;sequences&nbsp;to&nbsp;yield&nbsp;their&nbsp;elements&nbsp;(name_last,&nbsp;age):</span><span class="p_default"><br/>
</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">execute</span><span class="p_operator">(</span><span class="p_identifier">SELECT</span><span class="p_operator">)</span><span class="p_default"><br/>
</span><span class="p_word">for</span><span class="p_default">&nbsp;</span><span class="p_operator">(</span><span class="p_identifier">name_last</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">age</span><span class="p_operator">)</span><span class="p_default">&nbsp;</span><span class="p_word">in</span><span class="p_default">&nbsp;</span><span class="p_identifier">cur</span><span class="p_operator">:</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">print</span><span class="p_default">&nbsp;</span><span class="p_character">'%s&nbsp;is&nbsp;%d&nbsp;years&nbsp;old.'</span><span class="p_default">&nbsp;</span><span class="p_operator">%</span><span class="p_default">&nbsp;</span><span class="p_operator">(</span><span class="p_identifier">name_last</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">age</span><span class="p_operator">)</span><span class="p_default"><br/>
<br/>
</span><span class="p_commentline">#&nbsp;2.&nbsp;Equivalently:</span><span class="p_default"><br/>
</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">execute</span><span class="p_operator">(</span><span class="p_identifier">SELECT</span><span class="p_operator">)</span><span class="p_default"><br/>
</span><span class="p_word">for</span><span class="p_default">&nbsp;</span><span class="p_identifier">row</span><span class="p_default">&nbsp;</span><span class="p_word">in</span><span class="p_default">&nbsp;</span><span class="p_identifier">cur</span><span class="p_operator">:</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">print</span><span class="p_default">&nbsp;</span><span class="p_character">'%s&nbsp;is&nbsp;%d&nbsp;years&nbsp;old.'</span><span class="p_default">&nbsp;</span><span class="p_operator">%</span><span class="p_default">&nbsp;</span><span class="p_operator">(</span><span class="p_identifier">row</span><span class="p_operator">[</span><span class="p_number">0</span><span class="p_operator">],</span><span class="p_default">&nbsp;</span><span class="p_identifier">row</span><span class="p_operator">[</span><span class="p_number">1</span><span class="p_operator">])</span>
</div>
<p>Sample output:</p>
<pre class="literal-block">
Putin is 51 years old.
Yeltsin is 72 years old.
Putin is 51 years old.
Yeltsin is 72 years old.
</pre>
<p><em>Example 3</em></p>
<p>The following program is a simplistic table printer (applied in this example to
people)</p>
<div class="code-block">
<span class="p_word">from</span><span class="p_default">&nbsp;</span><span class="p_identifier">pysqlite2</span><span class="p_default">&nbsp;</span><span class="p_word">import</span><span class="p_default">&nbsp;</span><span class="p_identifier">dbapi2</span><span class="p_default">&nbsp;</span><span class="p_word">as</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">FIELD_MAX_WIDTH</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_number">20</span><span class="p_default"><br/>
</span><span class="p_identifier">TABLE_NAME</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_character">'people'</span><span class="p_default"><br/>
</span><span class="p_identifier">SELECT</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_character">'select&nbsp;*&nbsp;from&nbsp;%s&nbsp;order&nbsp;by&nbsp;age,&nbsp;name_last'</span><span class="p_default">&nbsp;</span><span class="p_operator">%</span><span class="p_default">&nbsp;</span><span class="p_identifier">TABLE_NAME</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">con</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_operator">.</span><span class="p_identifier">connect</span><span class="p_operator">(</span><span class="p_string">"mydb"</span><span class="p_operator">)</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">cur</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">con</span><span class="p_operator">.</span><span class="p_identifier">cursor</span><span class="p_operator">()</span><span class="p_default"><br/>
</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">execute</span><span class="p_operator">(</span><span class="p_identifier">SELECT</span><span class="p_operator">)</span><span class="p_default"><br/>
<br/>
</span><span class="p_commentline">#&nbsp;Print&nbsp;a&nbsp;header.</span><span class="p_default"><br/>
</span><span class="p_word">for</span><span class="p_default">&nbsp;</span><span class="p_identifier">fieldDesc</span><span class="p_default">&nbsp;</span><span class="p_word">in</span><span class="p_default">&nbsp;</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">description</span><span class="p_operator">:</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">print</span><span class="p_default">&nbsp;</span><span class="p_identifier">fieldDesc</span><span class="p_operator">[</span><span class="p_number">0</span><span class="p_operator">].</span><span class="p_identifier">ljust</span><span class="p_operator">(</span><span class="p_identifier">FIELD_MAX_WIDTH</span><span class="p_operator">)</span><span class="p_default">&nbsp;</span><span class="p_operator">,</span><span class="p_default"><br/>
</span><span class="p_word">print</span><span class="p_default">&nbsp;</span><span class="p_commentline">#&nbsp;Finish&nbsp;the&nbsp;header&nbsp;with&nbsp;a&nbsp;newline.</span><span class="p_default"><br/>
</span><span class="p_word">print</span><span class="p_default">&nbsp;</span><span class="p_character">'-'</span><span class="p_default">&nbsp;</span><span class="p_operator">*</span><span class="p_default">&nbsp;</span><span class="p_number">78</span><span class="p_default"><br/>
<br/>
</span><span class="p_commentline">#&nbsp;For&nbsp;each&nbsp;row,&nbsp;print&nbsp;the&nbsp;value&nbsp;of&nbsp;each&nbsp;field&nbsp;left-justified&nbsp;within</span><span class="p_default"><br/>
</span><span class="p_commentline">#&nbsp;the&nbsp;maximum&nbsp;possible&nbsp;width&nbsp;of&nbsp;that&nbsp;field.</span><span class="p_default"><br/>
</span><span class="p_identifier">fieldIndices</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">range</span><span class="p_operator">(</span><span class="p_identifier">len</span><span class="p_operator">(</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">description</span><span class="p_operator">))</span><span class="p_default"><br/>
</span><span class="p_word">for</span><span class="p_default">&nbsp;</span><span class="p_identifier">row</span><span class="p_default">&nbsp;</span><span class="p_word">in</span><span class="p_default">&nbsp;</span><span class="p_identifier">cur</span><span class="p_operator">:</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">for</span><span class="p_default">&nbsp;</span><span class="p_identifier">fieldIndex</span><span class="p_default">&nbsp;</span><span class="p_word">in</span><span class="p_default">&nbsp;</span><span class="p_identifier">fieldIndices</span><span class="p_operator">:</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">fieldValue</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">str</span><span class="p_operator">(</span><span class="p_identifier">row</span><span class="p_operator">[</span><span class="p_identifier">fieldIndex</span><span class="p_operator">])</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">print</span><span class="p_default">&nbsp;</span><span class="p_identifier">fieldValue</span><span class="p_operator">.</span><span class="p_identifier">ljust</span><span class="p_operator">(</span><span class="p_identifier">FIELD_MAX_WIDTH</span><span class="p_operator">)</span><span class="p_default">&nbsp;</span><span class="p_operator">,</span><span class="p_default"><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">print</span><span class="p_default">&nbsp;</span><span class="p_commentline">#&nbsp;Finish&nbsp;the&nbsp;row&nbsp;with&nbsp;a&nbsp;newline.</span>
</div>
<p>Sample output:</p>
<pre class="literal-block">
name_last            age
------------------------------------------------------------------------------
Putin                51
Yeltsin              72
</pre>
<p><em>Example 4</em></p>
<p>Let's insert more people into the people table:</p>
<div class="code-block">
<span class="p_word">from</span><span class="p_default">&nbsp;</span><span class="p_identifier">pysqlite2</span><span class="p_default">&nbsp;</span><span class="p_word">import</span><span class="p_default">&nbsp;</span><span class="p_identifier">dbapi2</span><span class="p_default">&nbsp;</span><span class="p_word">as</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">con</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_operator">.</span><span class="p_identifier">connect</span><span class="p_operator">(</span><span class="p_string">"mydb"</span><span class="p_operator">)</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">cur</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">con</span><span class="p_operator">.</span><span class="p_identifier">cursor</span><span class="p_operator">()</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">newPeople</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_operator">(</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_operator">(</span><span class="p_character">'Lebed'</span><span class="p_default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_number">53</span><span class="p_operator">),</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_operator">(</span><span class="p_character">'Zhirinovsky'</span><span class="p_default">&nbsp;</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_number">57</span><span class="p_operator">),</span><span class="p_default"><br/>
&nbsp;&nbsp;</span><span class="p_operator">)</span><span class="p_default"><br/>
<br/>
</span><span class="p_word">for</span><span class="p_default">&nbsp;</span><span class="p_identifier">person</span><span class="p_default">&nbsp;</span><span class="p_word">in</span><span class="p_default">&nbsp;</span><span class="p_identifier">newPeople</span><span class="p_operator">:</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">execute</span><span class="p_operator">(</span><span class="p_string">"insert&nbsp;into&nbsp;people&nbsp;(name_last,&nbsp;age)&nbsp;values&nbsp;(?,&nbsp;?)"</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">person</span><span class="p_operator">)</span><span class="p_default"><br/>
<br/>
</span><span class="p_commentline">#&nbsp;The&nbsp;changes&nbsp;will&nbsp;not&nbsp;be&nbsp;saved&nbsp;unless&nbsp;the&nbsp;transaction&nbsp;is&nbsp;committed&nbsp;explicitly:</span><span class="p_default"><br/>
</span><span class="p_identifier">con</span><span class="p_operator">.</span><span class="p_identifier">commit</span><span class="p_operator">()</span><span class="p_default"><br/>
</span>
</div>
<p>Note the use of a parameterized SQL statement above. When dealing with
repetitive statements, this is much faster and less error-prone than assembling
each SQL statement manually.</p>
<p>It's also worth noting that in the example above, the code:</p>
<p>It's also worth noting that in the example above, the code:</p>
<div class="code-block">
<span class="p_word">for</span><span class="p_default">&nbsp;</span><span class="p_identifier">person</span><span class="p_default">&nbsp;</span><span class="p_word">in</span><span class="p_default">&nbsp;</span><span class="p_identifier">newPeople</span><span class="p_operator">:</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">execute</span><span class="p_operator">(</span><span class="p_string">"insert&nbsp;into&nbsp;people&nbsp;(name_last,&nbsp;age)&nbsp;values&nbsp;(?,&nbsp;?)"</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">person</span><span class="p_operator">)</span>
</div>
<p>could be rewritten as:</p>
<div class="code-block">
<span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">executemany</span><span class="p_operator">(</span><span class="p_string">"insert&nbsp;into&nbsp;people&nbsp;(name_last,&nbsp;age)&nbsp;values&nbsp;(?,&nbsp;?)"</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">newPeople</span><span class="p_operator">)</span>
</div>
<p>After running Example 4, the table printer from Example 3 would print:</p>
<pre class="literal-block">
name_last            age
------------------------------------------------------------------------------
Putin                51
Lebed                53
Zhirinovsky          57
Yeltsin              72
</pre>
<div class="line-block">
<div class="line"><br /></div>
</div>
<hr class="docutils" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="native-database-engine-features-and-extensions-beyond-the-python-db-api">
<h1><a name="native-database-engine-features-and-extensions-beyond-the-python-db-api">3. Native Database Engine Features and Extensions Beyond the Python DB API</a></h1>
<div class="section" id="creating-user-defined-functions">
<h2><a name="creating-user-defined-functions">3.1 Creating user-defined functions</a></h2>
<p>SQLite supports user-defined functions.  Using pysqlite, you can create new
functions with the connection's <strong>create_function</strong> method:</p>
<blockquote>
<div class="code-block">
<span class="p_word">def</span><span class="p_default">&nbsp;</span><span class="p_defname">create_function</span><span class="p_operator">(</span><span class="p_identifier">self</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">name</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">numparams</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">func</span><span class="p_operator">)</span>
</div>
<dl class="docutils">
<dt><em>name</em></dt>
<dd>the name of your function in SQL</dd>
<dt><em>numparams</em></dt>
<dd>the number of parameters your function accepts, -1 if it accepts any
number of parameters</dd>
<dt><em>func</em></dt>
<dd>the Python function</dd>
</dl>
<p>The function can return any of pysqlite's supported SQLite types: unicode,
str, int, long, float, buffer and None.  The function should never raise an
exception.</p>
<p>Example:</p>
<div class="code-block">
<span class="p_word">def</span><span class="p_default">&nbsp;</span><span class="p_defname">md5sum</span><span class="p_operator">(</span><span class="p_identifier">t</span><span class="p_operator">):</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">return</span><span class="p_default">&nbsp;</span><span class="p_identifier">md5</span><span class="p_operator">.</span><span class="p_identifier">md5</span><span class="p_operator">(</span><span class="p_identifier">t</span><span class="p_operator">).</span><span class="p_identifier">hexdigest</span><span class="p_operator">()</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">con</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_operator">.</span><span class="p_identifier">connect</span><span class="p_operator">(</span><span class="p_string">":memory:"</span><span class="p_operator">)</span><span class="p_default"><br/>
</span><span class="p_identifier">con</span><span class="p_operator">.</span><span class="p_identifier">create_function</span><span class="p_operator">(</span><span class="p_string">"md5"</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_number">1</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">md5sum</span><span class="p_operator">)</span><span class="p_default"><br/>
</span><span class="p_identifier">cur</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">con</span><span class="p_operator">.</span><span class="p_identifier">cursor</span><span class="p_operator">()</span><span class="p_default"><br/>
</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">execute</span><span class="p_operator">(</span><span class="p_string">"select&nbsp;md5(?)"</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_operator">(</span><span class="p_string">"foo"</span><span class="p_operator">,))</span><span class="p_default"><br/>
</span><span class="p_word">print</span><span class="p_default">&nbsp;</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">fetchone</span><span class="p_operator">()[</span><span class="p_number">0</span><span class="p_operator">]</span>
</div>
</blockquote>
</div>
<div class="section" id="creating-user-defined-aggregates">
<h2><a name="creating-user-defined-aggregates">3.2 Creating user-defined aggregates</a></h2>
<p>SQLite supports user-defined aggregate functions. Using pysqlite, you can
create new aggregate functions with the connection's <em>create_aggregate</em> method.</p>
<blockquote>
<div class="code-block">
<span class="p_word">def</span><span class="p_default">&nbsp;</span><span class="p_defname">create_aggregate</span><span class="p_operator">(</span><span class="p_identifier">self</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">name</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">numparams</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">aggregate_class</span><span class="p_operator">)</span>
</div>
<p>The aggregate class must implement a <em>step</em> method, which accepts the
number of parameters defined in <em>create_aggregate</em>, and a <em>finalize</em>
method which will return the final result of the aggregate.</p>
<p>The <em>finalize</em> method can return any of pysqlite's supported SQLite types:
unicode, str, int, long, float, buffer and None. The aggregate class's
methods should never raise any exception.</p>
<p>Example:</p>
<div class="code-block">
<span class="p_word">from</span><span class="p_default">&nbsp;</span><span class="p_identifier">pysqlite2</span><span class="p_default">&nbsp;</span><span class="p_word">import</span><span class="p_default">&nbsp;</span><span class="p_identifier">dbapi2</span><span class="p_default">&nbsp;</span><span class="p_word">as</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_default"><br/>
<br/>
</span><span class="p_word">class</span><span class="p_default">&nbsp;</span><span class="p_classname">MySum</span><span class="p_operator">:</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">def</span><span class="p_default">&nbsp;</span><span class="p_defname">__init__</span><span class="p_operator">(</span><span class="p_identifier">self</span><span class="p_operator">):</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">self</span><span class="p_operator">.</span><span class="p_identifier">count</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_number">0</span><span class="p_default"><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">def</span><span class="p_default">&nbsp;</span><span class="p_defname">step</span><span class="p_operator">(</span><span class="p_identifier">self</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">value</span><span class="p_operator">):</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">self</span><span class="p_operator">.</span><span class="p_identifier">count</span><span class="p_default">&nbsp;</span><span class="p_operator">+=</span><span class="p_default">&nbsp;</span><span class="p_identifier">value</span><span class="p_default"><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">def</span><span class="p_default">&nbsp;</span><span class="p_defname">finalize</span><span class="p_operator">(</span><span class="p_identifier">self</span><span class="p_operator">):</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">return</span><span class="p_default">&nbsp;</span><span class="p_identifier">self</span><span class="p_operator">.</span><span class="p_identifier">count</span><span class="p_default"><br/>
<br/>
</span><span class="p_identifier">con</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">sqlite</span><span class="p_operator">.</span><span class="p_identifier">connect</span><span class="p_operator">(</span><span class="p_string">":memory:"</span><span class="p_operator">)</span><span class="p_default"><br/>
</span><span class="p_identifier">con</span><span class="p_operator">.</span><span class="p_identifier">create_aggregate</span><span class="p_operator">(</span><span class="p_string">"mysum"</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_number">1</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">MySum</span><span class="p_operator">)</span><span class="p_default"><br/>
</span><span class="p_identifier">cur</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">con</span><span class="p_operator">.</span><span class="p_identifier">cursor</span><span class="p_operator">()</span><span class="p_default"><br/>
</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">execute</span><span class="p_operator">(</span><span class="p_string">"create&nbsp;table&nbsp;test(i)"</span><span class="p_operator">)</span><span class="p_default"><br/>
</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">execute</span><span class="p_operator">(</span><span class="p_string">"insert&nbsp;into&nbsp;test(i)&nbsp;values&nbsp;(1)"</span><span class="p_operator">)</span><span class="p_default"><br/>
</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">execute</span><span class="p_operator">(</span><span class="p_string">"insert&nbsp;into&nbsp;test(i)&nbsp;values&nbsp;(2)"</span><span class="p_operator">)</span><span class="p_default"><br/>
</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">execute</span><span class="p_operator">(</span><span class="p_string">"select&nbsp;mysum(i)&nbsp;from&nbsp;test"</span><span class="p_operator">)</span><span class="p_default"><br/>
</span><span class="p_word">print</span><span class="p_default">&nbsp;</span><span class="p_identifier">cur</span><span class="p_operator">.</span><span class="p_identifier">fetchone</span><span class="p_operator">()[</span><span class="p_number">0</span><span class="p_operator">]</span>
</div>
</blockquote>
</div>
</div>
</div>
</body>
</html>
